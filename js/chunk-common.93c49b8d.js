"use strict";(self["webpackChunkjanereka_ryru"]=self["webpackChunkjanereka_ryru"]||[]).push([[64],{1098:(a,e,t)=>{t.d(e,{b:()=>I});var i=t(4543);t(246);function n(a,e,t){this.name=a,this.message=e,this.detail=t}const o=i.z.getSessionManager();function r(){if(!o.isAuthenticated())throw new n("AuthenticationError","No user is authenticated.","Invalid session.")}function s(){if(!o.isAdmin())throw new n("AuthenticationError","The current user does not have administrative permissions.","Invalid permissions. User is not admin.")}function d(a){return 0===Object.keys(a).length}function l(a){if(d(a))throw new n("MetadataValidationError","Media data is empty. Can not submit.","Invalid `mediaDataObject`.");if(!a.title)throw new n("MetadataValidationError","Media title is empty. Can not submit.","Invalid `mediaDataObject`.");if(!a.description)throw new n("MetadataValidationError","Media description is empty. Can not submit.","Invalid `mediaDataObject`.");if(!a.mediaType)throw new n("MetadataValidationError","Media file type was not set. Can not submit.","Invalid `mediaDataObject`.");if(!Array.isArray(a.tags))throw new n("MetadataValidationError","Media tags are not set as array. Can not submit.","Invalid `mediaDataObject`.");if(a.tags.forEach((a=>{if("string"!==typeof a)throw new n("MetadataValidationError","One of the media tags is not a string. Can not submit.","Invalid `mediaDataObject`.")})),!a.authorname)throw new n("MetadataValidationError","Author name not found. Can not submit.","Invalid `mediaDataObject`.");if(!a.tribe)throw new n("MetadataValidationError","Author indigenous group not found. Can not submit.","Invalid `mediaDataObject`.")}function c(a){if(l(a),!a.mediaPath)throw new n("FileDataValidationError","No media path found. Can not upload.","Invalid `mediaDataObject`.")}function u(a){if(d(a))throw new n("MediaUpdateValidationError","Media data is empty. Can not upload.","Invalid `mediaDataObject`.");if(!a.mediaPath)throw new n("MediaUpdateValidationError","No media path found. Can not upload.","Invalid `mediaDataObject`.")}function p(a){if(d(a))throw new n("DeletionValidationError","Media data is empty. Unable to delete.","Invalid `mediaDataObject`.");if(!a.mediaPath)throw new n("DeletionValidationError","No media path found. Unable to delete.","Invalid `mediaDataObject`.")}function m(a){if(d(a))throw new n("PublicationValidationError","Media data is empty. Unable to publish.","Invalid `mediaDataObject`.");if(!a.mediaPath)throw new n("PublicationValidationError","No media path found. Unable to publish.","Invalid `mediaDataObject`.")}t(71),t(7965),t(6016);var h=t(5474);async function g(a,e){try{const t=new FormData;t.append("titulo",a.title),t.append("descricao",a.description),t.append("tipo",a.mediaType),t.append("tags",a.tags.join(", ")),t.append("autor",a.authorname),t.append("mocambo",a.tribe);const{data:i}=await(0,h.api)({method:"post",url:"/acervo/midia",data:t,headers:{token:e,"Content-Type":"application/x-www-form-urlencoded"}});return a.mediaPath=i.path,a}catch(t){throw new n("MetadataSubmissionError","Error while requesting media metadata submission. If error persists, please contact an administrator.",t)}}async function w(a,e){try{const t=new FormData;t.append("arquivo",a.mediaFile),await(0,h.api)({method:"post",url:`/acervo/upload/${a.mediaPath}`,data:t,headers:{token:e}})}catch(t){throw new n("FileUploadError","Error during file upload. Deletion request dispatched for the corresponding path. If error persists, please contact an administrator.",t)}}async function f(a,e){try{const t=new FormData;t.append("titulo",a.title),t.append("descricao",a.description),t.append("tags",a.tags.join(", ")),t.append("autor",a.authorname),t.append("mocambo",a.tribe),await(0,h.api)({method:"put",url:`/acervo/midia/${a.mediaPath}`,data:t,headers:{token:e,"Content-Type":"application/x-www-form-urlencoded"}})}catch(t){throw new n("MediaUpdateError","Error while requesting media metadata update. If error persists, please contact an administrator.",t)}}async function b(a,e){try{await(0,h.api)({method:"delete",url:`/acervo/midia/${encodeURI(a.mediaPath)}`,headers:{token:e}})}catch(t){throw new n("MediaDeletionError","Error while requesting media deletion. If error persists, please contact an administrator.",t)}}async function y(a,e){try{await(0,h.api)({method:"put",url:`/acervo/publish/${a.mediaPath}`,headers:{token:e}})}catch(t){throw new n("MediaPublicationError","Error while requesting media publication. Unable to proceed.",t)}}async function M(a,e){try{const t=await(0,h.api)({method:"get",url:`/acervo/download/${encodeURIComponent(a)}`,token:e,responseType:"blob"}),i=URL.createObjectURL(t.data);return i}catch(t){throw new n("MediaDownloadError","Error while requesting media file. Unable to download.",t)}}async function v(a,e){try{const{data:t}=await h.api.get(a,{headers:{token:e}});return t}catch(t){throw new n("MediaFetchError",`Error while requesting media resources to the API. Query string used: ${a}`,t)}}const k=i.z.getSessionManager();async function _(a){try{r(),l(a);const{token:e}=k.getSession(),t=await g(a,e),i=await P(t,e);return i}catch(e){return console.info(e),!1}}async function P(a,e=null){try{return e||(r(),e=k.getSession().token),c(a),await w(a,e),!0}catch(t){return console.info(t),await $(a,e),!1}}async function E(a){try{r(),u(a);const{token:e}=k.getSession();return await f(a,e),!0}catch(e){return console.info(e),!1}}async function $(a,e=null){try{return e||(r(),e=k.getSession().token),p(a),await b(a,e),!0}catch(t){return console.info(t),!1}}async function C(a){try{s(),m(a);const{token:e}=k.getSession();return await y(a,e),!0}catch(e){return console.info(e),!1}}async function j(a){try{r();const{token:e}=k.getSession(),t=await M(a,e);return t}catch(e){return console.info(e),!1}}async function T(a){try{r();const{token:e}=k.getSession(),t=await v(a,e);return t}catch(e){return console.info(e),!1}}const I=function(){function a(){this.session=i.z.getSessionManager(),this.token=null,this.mediaObject={},this.fetchMediaType="todos",this.pagTamanho=1e3,this.pagAtual=1,this.lastQuery="",this.defaultQuery=`/acervo/find?pag_tamanho=${this.pagTamanho}&pag_atual=${this.pagAtual}`,this.unmakeMediaObject=()=>{this.mediaObject={}},this.makeMediaObject=(a,e,t,i,n,o,r,s)=>{this.unmakeMediaObject(),this.mediaObject={title:a,description:e,tags:t,authorname:i,tribe:n,mediaFile:o,mediaType:r,mediaPath:s||null}},this.performMediaCreation=async()=>await _(this.mediaObject),this.performMediaUpdate=async()=>await E(this.mediaObject),this.performMediaPublication=async()=>await C(this.mediaObject),this.performMediaDeletion=async()=>await $(this.mediaObject),this.performMediaDownload=async a=>await j(a),this.getMediasFromUser=async(a,e=this.pagTamanho,t=this.pagAtual)=>{const i=`/acervo/find?pag_tamanho=${e}&pag_atual=${t}&creator=${a}&ordem_campo=created&ordem_decrescente=true`,n=await T(i);return n},this.getSubmissionsFromUser=async(a,e=this.pagTamanho,t=this.pagAtual)=>{const i=`/acervo/find?pag_tamanho=${e}&pag_atual=${t}&creator=${a}&status=published&ordem_campo=created&ordem_decrescente=true`,n=await T(i);return n},this.getAllUnpublishedMedias=async(a=this.pagTamanho,e=this.pagAtual)=>{const t=`/acervo/find?pag_tamanho=${a}&pag_atual=${e}&status=draft&ordem_campo=created&ordem_decrescente=true`,i=await T(t);return i},this.getMediasByHashtag=async(a,e=this.pagTamanho,t=this.pagAtual)=>{const i=`/acervo/find?hashtags=${a}&pag_tamanho=${e}&pag_atual=${t}&status=published`,n=await T(i);return this.lastQuery=n?i:"",n},this.getMediasByKeywords=async(a,e=this.pagTamanho,t=this.pagAtual)=>{const i=`/acervo/find?keywords=${a}&pag_tamanho=${e}&pag_atual=${t}&status=published`,n=await T(i);return this.lastQuery=n?i:"",n},this.getAudioMedias=async(a=this.pagTamanho,e=this.pagAtual)=>{const t=`/acervo/find?tipos=audio&pag_tamanho=${a}&pag_atual=${e}&status=published`,i=await T(t);return this.lastQuery=i?t:"",i},this.getFileMedias=async(a=this.pagTamanho,e=this.pagAtual)=>{const t=`/acervo/find?tipos=arquivo&pag_tamanho=${a}&pag_atual=${e}&status=published`,i=await T(t);return this.lastQuery=i?t:"",i},this.getImageMedias=async(a=this.pagTamanho,e=this.pagAtual)=>{const t=`/acervo/find?tipos=imagem&pag_tamanho=${a}&pag_atual=${e}&status=published`,i=await T(t);return this.lastQuery=i?t:"",i},this.getVideoMedias=async(a=this.pagTamanho,e=this.pagAtual)=>{const t=`/acervo/find?tipos=video&pag_tamanho=${a}&pag_atual=${e}&status=published`,i=await T(t);return this.lastQuery=i?t:"",i},this.getAllMedias=async(a=this.pagTamanho,e=this.pagAtual)=>{const t=`/acervo/find?pag_tamanho=${a}&pag_atual=${e}&status=published&ordem_campo=created&ordem_decrescente=true`,i=await T(t);return this.lastQuery=i?t:"",i},this.getMediasByContentType=async(a,e=this.pagTamanho,t=this.pagAtual)=>{let i;switch(a){case"audio":this.fetchMediaType="audio",i=await this.getAudioMedias(e,t);break;case"arquivo":this.fetchMediaType="arquivo",i=await this.getFileMedias(e,t);break;case"imagem":this.fetchMediaType="imagem",i=await this.getImageMedias(e,t);break;case"video":this.fetchMediaType="video",i=await this.getVideoMedias(e,t);break;case"todos":this.fetchMediaType="todos",i=await this.getAllMedias(e,t);break;default:this.fetchMediaType="todos",i=await this.getAllMedias(e,t)}return i},this.applyMediaSorting=async a=>{let e=this.lastQuery;switch(a){case"alphabetical":e+="&ordem_campo=titulo&ordem_decrescente=false";break;case"newer":e+="&ordem_campo=created&ordem_decrescente=true";break;case"older":e+="&ordem_campo=created&ordem_decrescente=false";break;default:e="";break}if(e){const a=await T(e);return a?{success:!0,data:a}:{success:!1}}return{success:!1}}}let e;function t(){return e=new a,e}return{getManager:()=>e||t()}}()},6712:(a,e,t)=>{t.r(e),t.d(e,{default:()=>w});var i=t(3673),n=t(2323);const o={class:"text-h6"},r={key:0,align:"center",class:"text-white text-bold text-uppercase bg-primary q-py-xs"};function s(a,e,t,s,d,l){const c=(0,i.up)("card-file"),u=(0,i.up)("card-image"),p=(0,i.up)("card-video"),m=(0,i.up)("card-audio"),h=(0,i.up)("q-card-section"),g=(0,i.up)("q-card"),w=(0,i.up)("contents-file"),f=(0,i.up)("contents-image"),b=(0,i.up)("contents-video"),y=(0,i.up)("contents-audio"),M=(0,i.up)("q-dialog");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",{onClick:e[0]||(e[0]=a=>l.toggleModal())},[(0,i.Wm)(g,{class:"cursor-pointer fit",style:{overflow:"hidden"}},{default:(0,i.w5)((()=>["arquivo"==t.card.tipo?((0,i.wg)(),(0,i.j4)(c,{key:0,media:t.card},null,8,["media"])):(0,i.kq)("",!0),"imagem"==t.card.tipo?((0,i.wg)(),(0,i.j4)(u,{key:1,media:t.card},null,8,["media"])):(0,i.kq)("",!0),"video"==t.card.tipo?((0,i.wg)(),(0,i.j4)(p,{key:2,media:t.card},null,8,["media"])):(0,i.kq)("",!0),"audio"==t.card.tipo?((0,i.wg)(),(0,i.j4)(m,{key:3,media:t.card},null,8,["media"])):(0,i.kq)("",!0),(0,i.Wm)(h,{class:"text-white bottom-overlay"},{default:(0,i.w5)((()=>[(0,i._)("p",o,(0,n.zw)(t.card.titulo),1),(0,i._)("strong",null,(0,n.zw)(a.$t("gallery.mediaDetailsAuthor")),1),(0,i.Uk)(" "+(0,n.zw)(t.card.autor),1)])),_:1})])),_:1}),"usuario"===this.$route.name&&"draft"===t.card.status?((0,i.wg)(),(0,i.iD)("div",r,(0,n.zw)(a.$t("user.isFilePublished")),1)):(0,i.kq)("",!0)]),(0,i.Wm)(M,{modelValue:d.modal,"onUpdate:modelValue":e[1]||(e[1]=a=>d.modal=a),persistent:"",maximized:""},{default:(0,i.w5)((()=>["arquivo"==t.card.tipo?((0,i.wg)(),(0,i.j4)(w,{key:0,media:t.card,allowEdition:t.allowMediaEdition},null,8,["media","allowEdition"])):(0,i.kq)("",!0),"imagem"==t.card.tipo?((0,i.wg)(),(0,i.j4)(f,{key:1,media:t.card,allowEdition:t.allowMediaEdition},null,8,["media","allowEdition"])):(0,i.kq)("",!0),"video"==t.card.tipo?((0,i.wg)(),(0,i.j4)(b,{key:2,media:t.card,allowEdition:t.allowMediaEdition},null,8,["media","allowEdition"])):(0,i.kq)("",!0),"audio"==t.card.tipo?((0,i.wg)(),(0,i.j4)(y,{key:3,media:t.card,allowEdition:t.allowMediaEdition},null,8,["media","allowEdition"])):(0,i.kq)("",!0)])),_:1},8,["modelValue"])])}t(71);const d={name:"CardWrapper",components:{CardFile:()=>t.e(580).then(t.bind(t,8580)),CardImage:()=>Promise.all([t.e(736),t.e(995)]).then(t.bind(t,2995)),CardVideo:()=>Promise.all([t.e(736),t.e(112)]).then(t.bind(t,3112)),CardAudio:()=>t.e(931).then(t.bind(t,9931)),ContentsFile:()=>Promise.all([t.e(736),t.e(610)]).then(t.bind(t,7610)),ContentsImage:()=>Promise.all([t.e(736),t.e(642)]).then(t.bind(t,6642)),ContentsVideo:()=>Promise.all([t.e(736),t.e(385)]).then(t.bind(t,3385)),ContentsAudio:()=>Promise.all([t.e(736),t.e(48)]).then(t.bind(t,8048))},props:{card:{type:Object,required:!0},allowMediaEdition:{type:Boolean,required:!0,default:!1}},data(){return{baseUrlImg:this.$axios.defaults.baseURL,modal:!1}},methods:{toggleModal(){this.modal=!this.modal,this.$emit("closeMenus")}}};var l=t(4260),c=t(151),u=t(5589),p=t(6778),m=t(7518),h=t.n(m);const g=(0,l.Z)(d,[["render",s]]),w=g;h()(d,"components",{QCard:c.Z,QCardSection:u.Z,QDialog:p.Z})},1292:(a,e,t)=>{t.r(e),t.d(e,{default:()=>w});var i=t(3673),n=t(2323);const o={class:"top-side-buttons-wrapper"},r={class:"col-xs-12 col-sm-6 col-md-4"};function s(a,e,t,s,d,l){const c=(0,i.up)("main-table-tabs"),u=(0,i.up)("q-btn"),p=(0,i.up)("card-wrapper"),m=(0,i.up)("q-table");return(0,i.wg)(),(0,i.j4)(m,{grid:"","row-key":"id",title:a.$t("gallery.mainTableTitle"),loading:t.loading,columns:d.columns,data:a.$props.midias,pagination:d.pagination,"rows-per-page-label":a.$t("gallery.paginationRowsPerPageLabel"),"card-container-class":"q-col-gutter-md"},{top:(0,i.w5)((()=>[(0,i.Wm)(c,{ref:"mediaTypeNavigationTabs",viewingFrom:t.viewingFrom,onFilterContent:e[0]||(e[0]=e=>a.$emit("filterContent",e))},null,8,["viewingFrom"]),(0,i._)("div",o,[(0,i.Wm)(u,{unelevated:"",icon:"cloud_upload",color:"primary",align:"between",onClick:e[1]||(e[1]=a=>l.sendMidia()),label:a.$t("gallery.buttonLabelSend")},null,8,["label"]),"mainGallery"===t.viewingFrom?((0,i.wg)(),(0,i.j4)(u,{key:0,unelevated:"",icon:"search",color:"primary",padding:"6px",class:"q-ml-xs",onClick:e[2]||(e[2]=e=>a.$emit("toggleFilter"))})):(0,i.kq)("",!0)])])),item:(0,i.w5)((n=>[(0,i._)("div",r,[(0,i.Wm)(p,{class:"column col content-card",card:n.row,allowMediaEdition:t.allowMediaEdition,onCloseMenus:e[3]||(e[3]=e=>a.$emit("closeMenus"))},null,8,["card","allowMediaEdition"])])])),pagination:(0,i.w5)((e=>[(0,i.Wm)(u,{icon:"first_page",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage},null,8,["disable","onClick"]),(0,i.Wm)(u,{icon:"chevron_left",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage},null,8,["disable","onClick"]),(0,i._)("span",null,(0,n.zw)(l.firstIndexInPage)+"-"+(0,n.zw)(l.lastIndexInPage)+" "+(0,n.zw)(a.$t("gallery.paginationOfPage"))+" "+(0,n.zw)(t.midias.length),1),(0,i.Wm)(u,{icon:"chevron_right",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage},null,8,["disable","onClick"]),(0,i.Wm)(u,{icon:"last_page",dense:"",flat:"",disable:e.isLastPage,onClick:e.lastPage},null,8,["disable","onClick"])])),_:1},8,["title","loading","columns","data","pagination","rows-per-page-label"])}t(71);const d={name:"MainTable",components:{CardWrapper:()=>Promise.all([t.e(736),t.e(64),t.e(278)]).then(t.bind(t,6712)),MainTableTabs:()=>Promise.all([t.e(736),t.e(850)]).then(t.bind(t,850))},props:{loading:{type:Boolean,required:!0,default:!0},midias:{type:Array,required:!0},viewingFrom:{type:String,required:!0,default:"mainGallery"},allowMediaEdition:{type:Boolean,required:!0,default:!1}},data(){return{columns:[{name:"title",label:"TÃ­tulo",field:a=>a.data.titulo},{name:"author",label:"Autor",field:a=>a.creator.username},{name:"id",label:"id",field:a=>a.smid}],pagination:{sortBy:"desc",descending:!1,page:1,rowsPerPage:12},activeTab:"all",user:this.$axios.defaults.headers.common.token}},computed:{isLogged:function(){return!!this.$axios.defaults.headers.common.token},lastIndexInPage:function(){const a=Math.ceil(this.midias.length/this.pagination.rowsPerPage);return a===this.pagination.page?this.midias.length:this.pagination.page*this.pagination.rowsPerPage},firstIndexInPage:function(){const a=this.pagination.page*this.pagination.rowsPerPage;return a-this.pagination.rowsPerPage+1}},methods:{sendMidia(){this.$router.push("/submissao")},defaultTab(){this.$refs.mediaTypeNavigationTabs.defaultTab()}}};var l=t(4260),c=t(8468),u=t(8240),p=t(7300),m=t(7518),h=t.n(m);const g=(0,l.Z)(d,[["render",s],["__scopeId","data-v-af3a0c68"]]),w=g;h()(d,"components",{QTable:c.Z,QBtn:u.Z,QPagination:p.Z})}}]);